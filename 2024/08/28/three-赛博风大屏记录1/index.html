<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>three案例实操|赛博风大屏Ⅰ | Pale Bule Dot</title><meta name="author" content="Shealin You"><meta name="copyright" content="Shealin You"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言参考案例：https:&#x2F;&#x2F;dragonir.github.io&#x2F;3d&#x2F;#&#x2F;earthDigital 基础环境react+vite+three.js+scss 目录： EarthDigital –images —-earth.jpg –index.jsx –index.scss 代码框架先导入些基本的： import &amp;#123; useEffect, useRef &amp;#125; from &amp;#">
<meta property="og:type" content="article">
<meta property="og:title" content="three案例实操|赛博风大屏Ⅰ">
<meta property="og:url" content="https://youxt-njnu.github.io/2024/08/28/three-%E8%B5%9B%E5%8D%9A%E9%A3%8E%E5%A4%A7%E5%B1%8F%E8%AE%B0%E5%BD%951/index.html">
<meta property="og:site_name" content="Pale Bule Dot">
<meta property="og:description" content="前言参考案例：https:&#x2F;&#x2F;dragonir.github.io&#x2F;3d&#x2F;#&#x2F;earthDigital 基础环境react+vite+three.js+scss 目录： EarthDigital –images —-earth.jpg –index.jsx –index.scss 代码框架先导入些基本的： import &amp;#123; useEffect, useRef &amp;#125; from &amp;#">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg">
<meta property="article:published_time" content="2024-08-28T03:12:05.000Z">
<meta property="article:modified_time" content="2024-10-05T12:02:36.629Z">
<meta property="article:author" content="Shealin You">
<meta property="article:tag" content="threejs">
<meta property="article:tag" content="shader">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://youxt-njnu.github.io/2024/08/28/three-%E8%B5%9B%E5%8D%9A%E9%A3%8E%E5%A4%A7%E5%B1%8F%E8%AE%B0%E5%BD%951/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'three案例实操|赛博风大屏Ⅰ',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-05 20:02:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Pale Bule Dot" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/tit.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">60</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="https://youxt-njnu.github.io/about_portfolio"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('https://wallroom.io/img/3840x2160/bg-81f2d39.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Pale Bule Dot"><img class="site-icon" src="https://cdn.jsdelivr.net/gh/youxt-njnu/blog-img/favicon.png"/><span class="site-name">Pale Bule Dot</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="https://youxt-njnu.github.io/about_portfolio"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">three案例实操|赛博风大屏Ⅰ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-28T03:12:05.000Z" title="发表于 2024-08-28 11:12:05">2024-08-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-05T12:02:36.629Z" title="更新于 2024-10-05 20:02:36">2024-10-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/WebGL/">WebGL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="three案例实操|赛博风大屏Ⅰ"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>参考案例：<a target="_blank" rel="noopener" href="https://dragonir.github.io/3d/#/earthDigital">https://dragonir.github.io/3d/#/earthDigital</a></p>
<h1 id="基础环境"><a href="#基础环境" class="headerlink" title="基础环境"></a>基础环境</h1><p>react+vite+three.js+scss</p>
<p>目录：</p>
<p>EarthDigital</p>
<p>–images</p>
<p>—-earth.jpg</p>
<p>–index.jsx</p>
<p>–index.scss</p>
<h1 id="代码框架"><a href="#代码框架" class="headerlink" title="代码框架"></a>代码框架</h1><p>先导入些基本的：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Three</span> <span class="keyword">from</span> <span class="string">&#x27;three&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">OrbitControls</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/examples/jsm/controls/OrbitControls&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mergeGeometries &#125; <span class="keyword">from</span> <span class="string">&#x27;three/examples/jsm/utils/BufferGeometryUtils&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.scss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> earthImg <span class="keyword">from</span> <span class="string">&#x27;/src/assets/3d/EarthDigital/images/earth.jpg&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>把项目架子搭起来：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">index</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123; &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;earth-digital&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">ref</span>=<span class="string">&#123;canvasRef&#125;</span> <span class="attr">className</span>=<span class="string">&quot;webgl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">header</span> <span class="attr">className</span>=<span class="string">&quot;hud-header&quot;</span>&gt;</span>header<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">header</span>&gt;</span>header<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">aside</span> <span class="attr">className</span>=<span class="string">&quot;hud-aside-left&quot;</span>&gt;</span>left<span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">aside</span> <span class="attr">className</span>=<span class="string">&quot;hud-aside-right&quot;</span>&gt;</span>right<span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">footer</span> <span class="attr">className</span>=<span class="string">&quot;hud-footer&quot;</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">&quot;background&quot;</span>&gt;</span>section<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> index</span><br></pre></td></tr></table></figure>

<p>一些前置变量和常规函数：—— initThree(), animate(), handleResize()</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> scene = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> camera = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> renderer = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> orbitControls = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> earth = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">let</span> canvasRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">initThree</span>();</span><br><span class="line">  <span class="title function_">animate</span>();</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handleResize);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, handleResize);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<p>场景初始化：—— scene, camera, renderer, orbitControls</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">initThree</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  scene = <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">Scene</span>();</span><br><span class="line">  camera = <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">45</span>, <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>, <span class="number">0.1</span>, <span class="number">50</span>);</span><br><span class="line">  camera.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">15.5</span>);</span><br><span class="line">  scene.<span class="title function_">add</span>(camera);</span><br><span class="line"></span><br><span class="line">  renderer = <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">WebGLRenderer</span>(&#123;</span><br><span class="line">    <span class="attr">canvas</span>: canvasRef.<span class="property">current</span>,</span><br><span class="line">    <span class="attr">antialias</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">alpha</span>: <span class="literal">true</span> <span class="comment">// transparent background</span></span><br><span class="line">  &#125;);</span><br><span class="line">  renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">  renderer.<span class="title function_">setPixelRatio</span>(<span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>, <span class="number">2</span>));</span><br><span class="line">  renderer.<span class="title function_">render</span>(scene, camera);</span><br><span class="line"></span><br><span class="line">  orbitControls = <span class="keyword">new</span> <span class="title class_">OrbitControls</span>(camera, renderer.<span class="property">domElement</span>);</span><br><span class="line">  orbitControls.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">  orbitControls.<span class="property">enablePan</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加上动画：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">animate</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 更新tween</span></span><br><span class="line">  <span class="comment">// TWEEN.update();</span></span><br><span class="line">  <span class="comment">// 模型动画</span></span><br><span class="line">  <span class="comment">// earth.rotation.y += 0.001;</span></span><br><span class="line">  renderer &amp;&amp; scene &amp;&amp; camera &amp;&amp; renderer.<span class="title function_">render</span>(scene, camera);</span><br><span class="line">  <span class="title function_">requestAnimationFrame</span>(animate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加上窗体适应：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleResize</span> = (<span class="params"></span>)=&gt;&#123;</span><br><span class="line">  camera.<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">  camera.<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">  renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="大地球模型"><a href="#大地球模型" class="headerlink" title="大地球模型"></a>大地球模型</h1><p>加入个函数：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">initThree</span>();</span><br><span class="line">  <span class="title function_">createPoints</span>();</span><br><span class="line">  <span class="title function_">animate</span>();</span><br><span class="line"> ......</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<h2 id="球体上的点"><a href="#球体上的点" class="headerlink" title="球体上的点"></a>球体上的点</h2><p>添加前置变量：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">const</span> <span class="title function_">createPoints</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> rad = <span class="number">5</span>; <span class="comment">// 球体半径</span></span><br><span class="line">    <span class="keyword">let</span> counter = <span class="number">75000</span>; <span class="comment">// 球体上的点数量</span></span><br><span class="line">    <span class="keyword">let</span> dlong = <span class="title class_">Math</span>.<span class="property">PI</span> * (<span class="number">3</span> - <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">5</span>)); <span class="comment">// 经度的增量</span></span><br><span class="line">    <span class="keyword">let</span> dz = <span class="number">2</span> / counter; <span class="comment">// 纬度的增量，也就是z轴的增量</span></span><br><span class="line">    <span class="keyword">let</span> z = <span class="number">1</span>- dz / <span class="number">2</span>; <span class="comment">// 初始z值</span></span><br><span class="line">    <span class="keyword">let</span> long = <span class="number">0</span>; <span class="comment">// 初始经度</span></span><br><span class="line">    <span class="keyword">let</span> r = <span class="number">0</span>; <span class="comment">// xy平面上的径向半径，类似于x^2+y^2=r^2(勾股三角),r^2+z^2=1(球半径，先1，后缩放至rad)</span></span><br><span class="line">    <span class="keyword">let</span> p = <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">Vector3</span>(); <span class="comment">// 用于存xyz的坐标</span></span><br><span class="line">    <span class="keyword">let</span> sph = <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">Spherical</span>(); <span class="comment">// 构建把上面的转换成球体坐标</span></span><br><span class="line">    <span class="keyword">let</span> dummyObj = <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">Object3D</span>(); <span class="comment">// 用于调整后续球面上plane的位置和朝向</span></span><br><span class="line">    <span class="keyword">let</span> geoms = []; <span class="comment">// 存储所有的plane</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> earthTexture = <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(earthImg);</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>为啥设置经度增量为上式子？</p>
<blockquote>
<p>经度增量设置为 <code>Math.PI * (3 - Math.sqrt(5))</code> 实际上是基于黄金角，这种方法常用于在球面上分布点以达到尽可能均匀的覆盖。这个值与黄金分割有关，具体如下：</p>
<ul>
<li><strong>黄金分割数</strong> (φ) 约为 1.618033988749895。</li>
<li>但在这里使用的是 <code>3 - Math.sqrt(5)</code>，计算结果大约为 0.7639320225002102，它是黄金分割数的一种数学转换，更具体地说，这个值实际上等于 ( 2 - \phi )。</li>
<li>当你将这个值乘以 (\pi) （圆周率），得到的角度是通过黄金分割原理计算得来的。这个角度有助于在球面上均匀地分布点，因为它避免了经纬线的对齐，从而在视觉上看起来更为均匀。</li>
</ul>
<p>黄金角是黄金分割数在圆上的应用。在自然界中，例如向日葵的种子排列、松果的鳞片布局等，都可以见到黄金角的应用。它能够优化空间利用率并减少重叠，因此在算法生成均匀分布的点时也经常使用这一角度。</p>
<p>在球面分布点时使用黄金角可以避免聚类并尽可能覆盖整个球面。这样的排列减少了任何给定区域内点过多聚集的情况，从而使点的分布更加均匀，这对于很多涉及到空间分布优化的领域，如计算机图形学、地理信息系统等是非常有用的。</p>
</blockquote>
<p>为什么z的初始值设置为这个let z &#x3D; 1 - dz &#x2F; 2;，而不是从0开始</p>
<blockquote>
<p>在构建球面分布时，将 <code>z</code> 的初始值设置为 <code>1 - dz / 2</code> 而不是从 0 开始的原因是为了确保点均匀覆盖整个球体，包括顶部和底部。具体原因包括：</p>
<p>避免极点的聚集</p>
<ul>
<li>球体的顶部和底部（即极点）是特殊的位置，如果从 z &#x3D; 0 或 z &#x3D; 1 开始，可能会在这些极点处导致点过度聚集或分布不均。</li>
<li>通过将 <code>z</code> 的初始值设置为 <code>1 - dz / 2</code>，相当于在 z 轴上对点的位置进行了微小的偏移，使得第一个点和最后一个点都不会精确地位于球体的极点上，而是稍微偏离中心。这有助于改善球面上点的分布均匀性。</li>
</ul>
<p>确保覆盖全球</p>
<ul>
<li>由于 <code>dz = 2 / counter</code>，这意味着 z 值将从 1 开始，逐渐递减至 -1，覆盖整个球体。</li>
<li>初始值 <code>1 - dz / 2</code> 实际上将第一个点的 z 值设置为接近 1，但略低于 1，确保点从球体的顶部开始，同时不会与球顶重合。</li>
</ul>
<p>均匀分布</p>
<ul>
<li>此方法确保了点在垂直方向上也是均匀分布的。通过从 <code>1 - dz / 2</code> 开始，每个点的 z 值都是均匀地在 z 轴上偏移的，从而避免了在接近极点区域的不均匀密度。</li>
</ul>
</blockquote>
<p>➡️ 后话1 ☕️</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> maxImpactAmount = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> impacts = [];</span><br><span class="line"><span class="comment">// let trails = [];</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; maxImpactAmount; i++) &#123;</span><br><span class="line">  impacts.<span class="title function_">push</span>(&#123;</span><br><span class="line">    <span class="attr">impactPosition</span>: <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">Vector3</span>().<span class="title function_">random</span>().<span class="title function_">subScalar</span>(<span class="number">0.5</span>).<span class="title function_">setLength</span>(<span class="number">5</span>),</span><br><span class="line">    <span class="attr">impactMaxRadius</span>: <span class="number">5</span> * <span class="title class_">Three</span>.<span class="property">MathUtils</span>.<span class="title function_">randFloat</span>(<span class="number">0.5</span>, <span class="number">0.75</span>), <span class="comment">// Three.Math.randFloat会报错</span></span><br><span class="line">    <span class="attr">impactRatio</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">prevPosition</span>: <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">Vector3</span>().<span class="title function_">random</span>().<span class="title function_">subScalar</span>(<span class="number">0.5</span>).<span class="title function_">setLength</span>(<span class="number">5</span>),</span><br><span class="line">    <span class="attr">trailRatio</span>: &#123; <span class="attr">value</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    <span class="attr">trailLength</span>: &#123; <span class="attr">value</span>: <span class="number">0</span> &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// makeTrail(i);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>➡️ 后话2 ☕️</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> params = &#123;</span><br><span class="line">  <span class="attr">colors</span>: &#123;<span class="attr">base</span>: <span class="string">&#x27;#f9f002&#x27;</span>, <span class="attr">gradInner</span>: <span class="string">&#x27;#8ae66e&#x27;</span>, <span class="attr">gradOuter</span>: <span class="string">&#x27;#03c03c&#x27;</span>&#125;,</span><br><span class="line">  <span class="attr">reset</span>: <span class="function">()=&gt;</span> &#123; orbitControls.<span class="title function_">reset</span>() &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> uniforms = &#123;</span><br><span class="line">  <span class="attr">impacts</span>: &#123;<span class="attr">value</span>: impacts&#125;,</span><br><span class="line">  <span class="attr">maxSize</span>: &#123;<span class="attr">value</span>: <span class="number">.04</span>&#125;, <span class="comment">// 陆地色块大小</span></span><br><span class="line">  <span class="attr">minSize</span>: &#123; <span class="attr">value</span>: <span class="number">.025</span>&#125;, <span class="comment">// 海洋色块大小</span></span><br><span class="line">  <span class="attr">waveHeight</span>: &#123;<span class="attr">value</span>: <span class="number">.1</span>&#125;, <span class="comment">// 冲击波高度</span></span><br><span class="line">  <span class="attr">scaling</span>: &#123;<span class="attr">value</span>: <span class="number">1</span>&#125;, <span class="comment">// 冲击波范围</span></span><br><span class="line">  <span class="attr">gradInner</span>: &#123; <span class="attr">value</span>: <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">Color</span>(params.<span class="property">colors</span>.<span class="property">gradInner</span>)&#125;, <span class="comment">// 冲击波径向渐变内侧颜色</span></span><br><span class="line">  <span class="attr">gradOuter</span>: &#123; <span class="attr">value</span>: <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">Color</span>(params.<span class="property">colors</span>.<span class="property">gradOuter</span>)&#125;, <span class="comment">// 冲击波径向渐变外侧颜色</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构造点：</p>
<ol>
<li>根据z的不同，得到r，再求得three坐标系下（）的三维坐标p，转成球体phi和theta的坐标sph;</li>
<li>修改long和z，保存p的朝向和模型矩阵；</li>
<li>利用plane构造球面上的点，通过新建、变换、设置中心点和uv坐标实现</li>
<li>plane里传入了两个属性：center(每个点对应的位置), uv(这个点的球面坐标，缩放到0-1范围内)</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i =<span class="number">0</span>;i&lt;counter;i++) &#123;</span><br><span class="line">  r = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">1</span> - z * z);</span><br><span class="line">  p.<span class="title function_">set</span>(r * <span class="title class_">Math</span>.<span class="title function_">cos</span>(long), z, -r * <span class="title class_">Math</span>.<span class="title function_">sin</span>(long)).<span class="title function_">multiplyScalar</span>(rad);</span><br><span class="line">  sph.<span class="title function_">setFromVector3</span>(p);</span><br><span class="line">  long = long + dlong;</span><br><span class="line">  z = z - dz;</span><br><span class="line">  dummyObj.<span class="title function_">lookAt</span>(p);</span><br><span class="line">  dummyObj.<span class="title function_">updateMatrix</span>();</span><br><span class="line">  <span class="comment">// 构建球面上的plane，同时设置uv坐标</span></span><br><span class="line">  <span class="keyword">let</span> plane = <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">  plane.<span class="title function_">applyMatrix4</span>(dummyObj.<span class="property">matrix</span>);</span><br><span class="line">  plane.<span class="title function_">translate</span>(p.<span class="property">x</span>,p.<span class="property">y</span>,p.<span class="property">z</span>);</span><br><span class="line">  <span class="keyword">let</span> centers = [p.<span class="property">x</span>,p.<span class="property">y</span>,p.<span class="property">z</span>,p.<span class="property">x</span>,p.<span class="property">y</span>,p.<span class="property">z</span>,p.<span class="property">x</span>,p.<span class="property">y</span>,p.<span class="property">z</span>,p.<span class="property">x</span>,p.<span class="property">y</span>,p.<span class="property">z</span>];</span><br><span class="line">  plane.<span class="title function_">setAttribute</span>(<span class="string">&#x27;center&#x27;</span>, <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">BufferAttribute</span>(<span class="keyword">new</span> <span class="title class_">Float32Array</span>(centers), <span class="number">3</span>));</span><br><span class="line">  <span class="keyword">let</span> uv = [(sph+<span class="title class_">Math</span>.<span class="property">PI</span>)/(<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>),<span class="number">1</span>-(sph.<span class="property">theta</span>/<span class="title class_">Math</span>.<span class="property">PI</span>)];</span><br><span class="line">  <span class="keyword">let</span> uvs = [uv.<span class="property">x</span>,uv.<span class="property">y</span>,uv.<span class="property">x</span>,uv.<span class="property">y</span>,uv.<span class="property">x</span>,uv.<span class="property">y</span>,uv.<span class="property">x</span>,uv.<span class="property">y</span>];</span><br><span class="line">  plane.<span class="title function_">setAttribute</span>(<span class="string">&#x27;baseUv&#x27;</span>, <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">BufferAttribute</span>(<span class="keyword">new</span> <span class="title class_">Float32Array</span>(uvs), <span class="number">2</span>));</span><br><span class="line">  geoms.<span class="title function_">push</span>(plane);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="球材质和构造"><a href="#球材质和构造" class="headerlink" title="球材质和构造"></a>球材质和构造</h2><p>构造Mesh</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">let</span> g = <span class="title function_">mergeGeometries</span>(geoms);</span><br><span class="line">  <span class="keyword">let</span> m = <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">Color</span>(params.<span class="property">colors</span>.<span class="property">base</span>),</span><br><span class="line">    <span class="attr">onBeforeCompile</span>: <span class="function"><span class="params">shader</span> =&gt;</span> &#123;</span><br><span class="line">      ......</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  m.<span class="property">defines</span> = &#123;<span class="string">&#x27;USE_UV&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;;</span><br><span class="line">  earth = <span class="keyword">new</span> <span class="title class_">Three</span>.<span class="title class_">Mesh</span>(g, m);</span><br><span class="line">  earth.<span class="property">rotation</span>.<span class="property">y</span> = <span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">  <span class="comment">// trails.forEach( t =&gt; earth.add(t));</span></span><br><span class="line">  earth.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>, -<span class="number">0.4</span>, <span class="number">0</span>);</span><br><span class="line">  scene.<span class="title function_">add</span>(earth);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>球体材质</p>
<p>基本量</p>
<ul>
<li><strong><code>struct impact</code></strong>: 定义了一个包含冲击点数据的结构，包括冲击的位置(<code>impactPosition</code>)、冲击的最大半径(<code>impactMaxRadius</code>)和冲击比例(<code>impactRatio</code>)。</li>
<li><strong><code>uniform impact impacts[]</code></strong>: 一个包含多个冲击点的数组。</li>
<li><strong><code>uniform sampler2D tex</code></strong>: 一个二维纹理，通常用于存储和检索数据（比如图像或者根据纹理生成的数据）。</li>
<li><strong><code>uniform float maxSize, minSize</code></strong>: 最大和最小尺寸。</li>
<li><strong><code>uniform float waveHeight</code></strong>: 波高。</li>
<li><strong><code>uniform float scaling</code></strong>: 缩放系数。</li>
<li><strong><code>attribute vec3 center</code></strong>: 顶点的中心位置。</li>
<li><strong><code>attribute vec2 baseUv</code></strong>: 顶点的基本UV坐标。</li>
<li><strong><code>varying float vFinalStep</code></strong> 和 <strong><code>varying float vMap</code></strong>: 这些是从顶点着色器传递到片段着色器的变量，用于进一步的渲染计算。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">shader.<span class="property">uniforms</span>.<span class="property">impacts</span> = uniforms.<span class="property">impacts</span>;</span><br><span class="line">       shader.<span class="property">uniforms</span>.<span class="property">maxSize</span> = uniforms.<span class="property">maxSize</span>;</span><br><span class="line">       shader.<span class="property">uniforms</span>.<span class="property">minSize</span> = uniforms.<span class="property">minSize</span>;</span><br><span class="line">       shader.<span class="property">uniforms</span>.<span class="property">waveHeight</span> = uniforms.<span class="property">waveHeight</span>;</span><br><span class="line">       shader.<span class="property">uniforms</span>.<span class="property">scaling</span> = uniforms.<span class="property">scaling</span>;</span><br><span class="line">       shader.<span class="property">uniforms</span>.<span class="property">gradInner</span> = uniforms.<span class="property">gradInner</span>;</span><br><span class="line">       shader.<span class="property">uniforms</span>.<span class="property">gradOuter</span> = uniforms.<span class="property">gradOuter</span>;</span><br><span class="line">       shader.<span class="property">uniforms</span>.<span class="property">tex</span> = &#123; <span class="attr">value</span>: earthTexture &#125;;</span><br></pre></td></tr></table></figure>

<p>顶点着色器逻辑</p>
<ul>
<li><strong>循环遍历每个冲击点</strong>：计算每个顶点与每个冲击点的距离，根据距离和冲击点的影响范围计算一个平滑的步进(<code>sstep</code>)。这个步进是基于 <code>smoothstep</code> 函数，用于创建冲击波的边界更加平滑的过渡效果。</li>
<li><strong><code>finalStep</code>的计算</strong>：累加所有冲击点对当前顶点的影响，使用 <code>clamp</code> 函数确保值在0到1之间。</li>
<li><strong><code>map</code>变量的计算</strong>：从纹理中获取当前顶点的green值，用于决定顶点的尺寸是 <code>maxSize</code> 还是 <code>minSize</code>，区分了陆地和海洋。</li>
<li><strong>顶点位置(<code>transformed</code>)的更新</strong>：根据 <code>map</code> 的结果和计算出的 <code>finalStep</code> 调整顶点位置，以实现位置的缩放和波纹效果。使用 <code>mix</code> 函数根据冲击波影响程度在原始尺寸和放大后的尺寸之间进行插值。波高(<code>waveHeight</code>)和 <code>finalStep</code> 的乘积决定了顶点沿法线方向的位移量。</li>
<li>这段代码通过计算每个顶点与一组冲击波的相对位置和影响，动态调整顶点位置和大小，从而在渲染过程中创建出动态的波纹效果。这种类型的着色器编程允许开发者创建复杂和动态的视觉效果，用于游戏开发、视觉艺术和模拟等领域。</li>
<li>补充：<code>baseUv</code> 在 Three.js 中是作为每个顶点的二维纹理坐标（<code>vec2</code>）被处理的。这些坐标是作为顶点属性上传到 GPU 的，后续在 GLSL 着色器中可以直接访问。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">shader.<span class="property">vertexShader</span> = <span class="string">`</span></span><br><span class="line"><span class="string">    struct impact &#123;</span></span><br><span class="line"><span class="string">      vec3 impactPosition;</span></span><br><span class="line"><span class="string">      float impactMaxRadius;</span></span><br><span class="line"><span class="string">      float impactRatio;</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    uniform impact impacts[<span class="subst">$&#123;maxImpactAmount&#125;</span>];</span></span><br><span class="line"><span class="string">    uniform sampler2D tex;</span></span><br><span class="line"><span class="string">    uniform float maxSize;</span></span><br><span class="line"><span class="string">    uniform float minSize;</span></span><br><span class="line"><span class="string">    uniform float waveHeight;</span></span><br><span class="line"><span class="string">    uniform float scaling;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    attribute vec3 center;</span></span><br><span class="line"><span class="string">    attribute vec2 baseUv;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    varying float vFinalStep;</span></span><br><span class="line"><span class="string">    varying float vMap;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    <span class="subst">$&#123;shader.vertexShader&#125;</span></span></span><br><span class="line"><span class="string">  `</span>.<span class="title function_">replace</span>(</span><br><span class="line">    <span class="string">`#include &lt;begin_vertex&gt;`</span>,</span><br><span class="line">    <span class="string">`#include &lt;begin_vertex&gt;</span></span><br><span class="line"><span class="string">    float finalStep = 0.0;</span></span><br><span class="line"><span class="string">    for (int i = 0; i &lt; <span class="subst">$&#123;maxImpactAmount&#125;</span>;i++)&#123;</span></span><br><span class="line"><span class="string">      float dist = distance(center, impacts[i].impactPosition);</span></span><br><span class="line"><span class="string">      float curRadius = impacts[i].impactMaxRadius * impacts[i].impactRatio;</span></span><br><span class="line"><span class="string">      float sstep = smoothstep(0., curRadius, dist) - smoothstep(curRadius - ( 0.25 * impacts[i].impactRatio ), curRadius, dist);</span></span><br><span class="line"><span class="string">      sstep *= 1. - impacts[i].impactRatio;</span></span><br><span class="line"><span class="string">      finalStep += sstep;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    finalStep = clamp(finalStep, 0., 1.);</span></span><br><span class="line"><span class="string">    vFinalStep = finalStep;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    float map = texture(tex, baseUv).g;</span></span><br><span class="line"><span class="string">    vMap = map;</span></span><br><span class="line"><span class="string">    float pSize = map &lt; 0.5 ? maxSize : minSize;</span></span><br><span class="line"><span class="string">    float scale = scaling;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    transformed = (position - center) * pSize * mix(1., scale * 1.25, finalStep) + center; // scale on wave</span></span><br><span class="line"><span class="string">    transformed += normal * finalStep * waveHeight; // lift on wave</span></span><br><span class="line"><span class="string">    `</span></span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<p>片元着色器逻辑</p>
<ul>
<li>传入对逐个点起作用的冲击强度和顶点纹理的g值；</li>
<li><strong>形状处理</strong> :</li>
<li>计算以屏幕中心为原点的 UV 坐标 <code>hUv</code>。（vUv是一个从0到1的二维向量，表示纹理坐标或顶点着色器传递给片段着色器的顶点位置）</li>
<li>N&#x3D;8常用于表示某种图形或模式中重复元素的数量</li>
<li><code>a</code> 是计算得到的向量 <code>hUv</code>的角度（相对于原点），使用的是反正切函数 <code>atan</code>，它返回从x轴到向量的角度。</li>
<li><code>r</code> 是每个扇区的角度范围，计算为 <code>2π</code> 除以扇区数量 <code>N</code>。</li>
<li><code>d</code> 是当前点到最近扇区边界的距离。</li>
<li><code>f</code> 是扇区中心到边界的距离。</li>
<li>如果 <code>d</code> 大于 <code>f</code>，则丢弃该片元（<code>discard</code>），只有距离扇区中心非常近的像素才能通过测试，这样可以创建更加锐利和明显的边界；</li>
<li>这有助于创建具有 N 边形形状的效果。</li>
<li><strong>颜色和渐变处理</strong>:</li>
<li><code>grad</code> 是内外渐变颜色的混合，基于 <code>d / f</code> 的值进行插值。</li>
<li><code>diffuseMap</code> 是根据 <code>vMap</code> 调整的漫反射颜色。 区分了陆地和海洋</li>
<li><code>col</code> 是漫反射颜色和渐变颜色的最终混合，其中使用了 <code>vFinalStep</code> 进行插值。</li>
<li>使用最终计算出的颜色 <code>col</code> 和原始的不透明度 <code>opacity</code> 创建新的 <code>vec4 diffuseColor</code>。</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">shader.<span class="property">fragmentShader</span> = <span class="string">`</span></span><br><span class="line"><span class="string">            uniform vec3 gradInner;</span></span><br><span class="line"><span class="string">            uniform vec3 gradOuter;</span></span><br><span class="line"><span class="string">            varying float vFinalStep;</span></span><br><span class="line"><span class="string">            varying float vMap;</span></span><br><span class="line"><span class="string">            <span class="subst">$&#123;shader.fragmentShader&#125;</span></span></span><br><span class="line"><span class="string">            `</span>.<span class="title function_">replace</span>(</span><br><span class="line">            <span class="string">`vec4 diffuseColor = vec4( diffuse, opacity );`</span>,</span><br><span class="line">            <span class="string">`</span></span><br><span class="line"><span class="string">            // shaping the point, pretty much from The Book of Shaders</span></span><br><span class="line"><span class="string">            vec2 hUv = (vUv - 0.5);</span></span><br><span class="line"><span class="string">            int N = 8;</span></span><br><span class="line"><span class="string">            float a = atan(hUv.x,hUv.y);</span></span><br><span class="line"><span class="string">            float r = PI2/float(N);</span></span><br><span class="line"><span class="string">            float d = cos(floor(.5+a/r)*r-a)*length(hUv);</span></span><br><span class="line"><span class="string">            float f = cos(PI / float(N)) * 0.5;</span></span><br><span class="line"><span class="string">            if (d &gt; f) discard;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            vec3 grad = mix(gradInner, gradOuter, clamp( d / f, 0., 1.)); // gradient</span></span><br><span class="line"><span class="string">            vec3 diffuseMap = diffuse * ((vMap &gt; 0.5) ? 0.5 : 1.);</span></span><br><span class="line"><span class="string">            vec3 col = mix(diffuseMap, grad, vFinalStep); // color on wave</span></span><br><span class="line"><span class="string">            //if (!gl_FrontFacing) col *= 0.25; // moderate the color on backside</span></span><br><span class="line"><span class="string">            vec4 diffuseColor = vec4( col , opacity );</span></span><br><span class="line"><span class="string">            `</span>);</span><br></pre></td></tr></table></figure>

<h3 id="补充-replace方法"><a href="#补充-replace方法" class="headerlink" title="补充 | replace方法"></a>补充 | replace方法</h3><p>上述vertex shader代码replace前：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">shader.vertexShader:  #include &lt;common&gt;</span><br><span class="line">#include &lt;batching_pars_vertex&gt;</span><br><span class="line">#include &lt;uv_pars_vertex&gt;</span><br><span class="line">#include &lt;envmap_pars_vertex&gt;</span><br><span class="line">#include &lt;color_pars_vertex&gt;</span><br><span class="line">#include &lt;fog_pars_vertex&gt;</span><br><span class="line">#include &lt;morphtarget_pars_vertex&gt;</span><br><span class="line">#include &lt;skinning_pars_vertex&gt;</span><br><span class="line">#include &lt;logdepthbuf_pars_vertex&gt;</span><br><span class="line">#include &lt;clipping_planes_pars_vertex&gt;</span><br><span class="line">void main() &#123;</span><br><span class="line">	#include &lt;uv_vertex&gt;</span><br><span class="line">	#include &lt;color_vertex&gt;</span><br><span class="line">	#include &lt;morphinstance_vertex&gt;</span><br><span class="line">	#include &lt;morphcolor_vertex&gt;</span><br><span class="line">	#include &lt;batching_vertex&gt;</span><br><span class="line">	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )</span><br><span class="line">		#include &lt;beginnormal_vertex&gt;</span><br><span class="line">		#include &lt;morphnormal_vertex&gt;</span><br><span class="line">		#include &lt;skinbase_vertex&gt;</span><br><span class="line">		#include &lt;skinnormal_vertex&gt;</span><br><span class="line">		#include &lt;defaultnormal_vertex&gt;</span><br><span class="line">	#endif</span><br><span class="line">	#include &lt;begin_vertex&gt;</span><br><span class="line">	#include &lt;morphtarget_vertex&gt;</span><br><span class="line">	#include &lt;skinning_vertex&gt;</span><br><span class="line">	#include &lt;project_vertex&gt;</span><br><span class="line">	#include &lt;logdepthbuf_vertex&gt;</span><br><span class="line">	#include &lt;clipping_planes_vertex&gt;</span><br><span class="line">	#include &lt;worldpos_vertex&gt;</span><br><span class="line">	#include &lt;envmap_vertex&gt;</span><br><span class="line">	#include &lt;fog_vertex&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述fragment shader代码replace前：</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line">shader.fragmentShader:  <span class="keyword">uniform</span> <span class="type">vec3</span> diffuse;</span><br><span class="line"><span class="keyword">uniform</span> <span class="type">float</span> opacity;</span><br><span class="line"><span class="meta">#ifndef FLAT_SHADED</span></span><br><span class="line">	<span class="keyword">varying</span> <span class="type">vec3</span> vNormal;</span><br><span class="line"><span class="meta">#endif</span></span><br><span class="line"><span class="meta">#include &lt;common&gt;</span></span><br><span class="line"><span class="meta">#include &lt;dithering_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;color_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;uv_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;map_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;alphamap_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;alphatest_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;alphahash_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;aomap_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;lightmap_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;envmap_common_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;envmap_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;fog_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;specularmap_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;logdepthbuf_pars_fragment&gt;</span></span><br><span class="line"><span class="meta">#include &lt;clipping_planes_pars_fragment&gt;</span></span><br><span class="line"><span class="type">void</span> main() &#123;</span><br><span class="line">	<span class="type">vec4</span> diffuseColor = <span class="type">vec4</span>( diffuse, opacity );</span><br><span class="line">	<span class="meta">#include &lt;clipping_planes_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;logdepthbuf_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;map_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;color_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;alphamap_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;alphatest_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;alphahash_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;specularmap_fragment&gt;</span></span><br><span class="line">	ReflectedLight reflectedLight = ReflectedLight( <span class="type">vec3</span>( <span class="number">0.0</span> ), <span class="type">vec3</span>( <span class="number">0.0</span> ), <span class="type">vec3</span>( <span class="number">0.0</span> ), <span class="type">vec3</span>( <span class="number">0.0</span> ) );</span><br><span class="line">	<span class="meta">#ifdef USE_LIGHTMAP</span></span><br><span class="line">		<span class="type">vec4</span> lightMapTexel = <span class="built_in">texture2D</span>( lightMap, vLightMapUv );</span><br><span class="line">		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;</span><br><span class="line">	<span class="meta">#else</span></span><br><span class="line">		reflectedLight.indirectDiffuse += <span class="type">vec3</span>( <span class="number">1.0</span> );</span><br><span class="line">	<span class="meta">#endif</span></span><br><span class="line">	<span class="meta">#include &lt;aomap_fragment&gt;</span></span><br><span class="line">	reflectedLight.indirectDiffuse *= diffuseColor.rgb;</span><br><span class="line">	<span class="type">vec3</span> outgoingLight = reflectedLight.indirectDiffuse;</span><br><span class="line">	<span class="meta">#include &lt;envmap_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;opaque_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;tonemapping_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;colorspace_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;fog_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;premultiplied_alpha_fragment&gt;</span></span><br><span class="line">	<span class="meta">#include &lt;dithering_fragment&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 WebGL 或 OpenGL 的着色器编程中，使用 <code>.replace</code> 方法来修改着色器代码是一种常见的技术，尤其是在处理复杂的、可配置的着色器系统时。这种方法提供了灵活性和动态生成或调整着色器代码的能力。这里的 <code>.replace</code> 方法的使用具体有以下几个目的和优点：</p>
<ol>
<li><strong>动态内容注入</strong></li>
</ol>
<p>通过 <code>.replace</code>，可以根据程序的需求或配置动态地插入特定的代码片段。在着色器中，这种能力特别有用，因为它允许在不改变原始着色器代码文件的基础上，根据不同的渲染需求修改着色器行为。</p>
<ol start="2">
<li><strong>条件编译</strong></li>
</ol>
<p>在多个不同的渲染场景下，可能需要着色器表现出不同的行为。使用 <code>.replace</code> 可以根据运行时条件选择性地添加或修改着色器代码，从而实现条件编译的效果。比如，根据对象是否受到特定影响，决定是否启用某些计算。</p>
<ol start="3">
<li><strong>避免硬编码</strong></li>
</ol>
<p>硬编码在着色器中是不灵活的，特别是在涉及到循环次数或数组大小等参数时。通过 <code>.replace</code> 方法，开发者可以在着色器代码运行前插入这些值，使着色器代码更加通用和可配置。例如，通过插入 <code>$&#123;maxImpactAmount&#125;</code> 来确定循环的次数，这使得同一份着色器代码可以适应不同数量的冲击点。</p>
<ol start="4">
<li><strong>模块化和代码复用</strong></li>
</ol>
<p>在大型项目中，可能需要在多个着色器之间共享或重用代码片段。通过使用 <code>.replace</code> 方法，可以从外部插入共享的代码片段或在多个着色器之间复用代码，提高维护性和一致性。</p>
<p>在你的示例中，<code>.replace</code> 方法被用来注入计算顶点最终位置的逻辑到一个基本的顶点着色器模板中。这种方式可以使主着色器代码保持相对不变，而特定的计算和行为可以根据需要动态地注入，如处理不同数量的冲击点或应用不同的动态效果。</p>
<h3 id="补充-define的作用"><a href="#补充-define的作用" class="headerlink" title="补充 | define的作用"></a>补充 | define的作用</h3><p>在 Three.js 中，<code>defines</code> 属性用于自定义着色器的预处理宏。这些宏是着色器代码中的条件编译指令，可以在编译着色器之前进行设置。通过设置这些宏，你可以启用或修改着色器的某些部分，从而调整其行为或性能，而无需改动着色器的主体代码。这为灵活性和重用提供了很好的支持。</p>
<p>使用场景</p>
<ol>
<li><strong>条件编译</strong>：<code>defines</code> 允许你根据需求启用或禁用着色器代码中的特定部分。例如，如果某个特性（如纹理映射）只在特定条件下使用，你可以通过 <code>defines</code> 来控制这一部分代码的编译。</li>
<li><strong>性能优化</strong>：通过禁用不需要的特性，可以减少着色器的复杂性，从而提高执行效率。例如，如果你知道你的材质不需要处理UV坐标，可以通过设置相应的宏来阻止编译这部分代码。</li>
</ol>
<p>在代码中，<code>m.defines = &#123;&#39;USE_UV&#39;: &#39;&#39;&#125;;</code>  这行代码设置了一个名为 <code>USE_UV</code> 的宏，虽然后面紧跟着的是一个空字符串，但它的存在足以让着色器编译器在预处理时认为 <code>USE_UV</code> 被定义了。在着色器代码中，可以使用预处理指令来检查这个宏：</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#ifdef USE_UV</span></span><br><span class="line">  <span class="comment">// 执行使用 UV 坐标的代码</span></span><br><span class="line"><span class="meta">#else</span></span><br><span class="line">  <span class="comment">// 执行不使用 UV 坐标的代码</span></span><br><span class="line"><span class="meta">#endif</span></span><br></pre></td></tr></table></figure>

<p>通过这种方式，如果 <code>m.defines</code> 包含 <code>USE_UV</code>，则着色器中依赖 UV 坐标的部分会被编译和执行；如果没有定义 <code>USE_UV</code>，则相关代码块不会被执行，从而可能减少计算负担。这种技术非常适合在运行时根据不同的材质属性或图形设置调整着色器行为，是图形编程中一种常见且强大的优化手段。</p>
<h3 id="补充-内部代码定义的变量"><a href="#补充-内部代码定义的变量" class="headerlink" title="补充 | 内部代码定义的变量"></a>补充 | 内部代码定义的变量</h3><p>在上述提供的 Three.js 的默认着色器代码中，<code>vUv</code> 变量的定义和使用确实存在，但它是通过 Three.js 的标准着色器系统内部的代码片段进行的。这里是具体的分析：</p>
<p>在顶点着色器代码中，有如下几行代码是关键：</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#include &lt;uv_pars_vertex&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">#include &lt;uv_vertex&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>&lt;uv_pars_vertex&gt;</code></strong>: 这个代码片段通常包含了与 UV 相关的参数定义，包括对 <code>vUv</code> 的声明。这个片段的作用是准备所有必要的 UV 相关数据，以便在顶点着色器中使用。</li>
<li><strong><code>&lt;uv_vertex&gt;</code></strong>: 这个代码片段负责将 UV 数据从顶点属性传递到 <code>vUv</code> 变量中。这通常包括从顶点数据中读取 UV 坐标，并将其赋值给 <code>vUv</code>。</li>
</ul>
<p>在片元着色器中，相关的代码片段包括：</p>
<figure class="highlight glsl"><table><tr><td class="code"><pre><span class="line"><span class="meta">#include &lt;uv_pars_fragment&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>&lt;uv_pars_fragment&gt;</code></strong>: 这个代码片段包括对 <code>vUv</code> 的使用，它从顶点着色器传递的数据中接收 UV 坐标。这在处理纹理映射和其他基于 UV 的操作时非常关键。</li>
</ul>
<p>在你的代码中，<code>vUv</code> 的处理是通过标准的 Three.js 着色器代码片段间接实现的。这种方法的优点是你无需直接在你的着色器代码中声明和定义 <code>vUv</code>，Three.js 已经在其着色器库中处理了所有这些操作。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://youxt-njnu.github.io">Shealin You</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://youxt-njnu.github.io/2024/08/28/three-%E8%B5%9B%E5%8D%9A%E9%A3%8E%E5%A4%A7%E5%B1%8F%E8%AE%B0%E5%BD%951/">https://youxt-njnu.github.io/2024/08/28/three-%E8%B5%9B%E5%8D%9A%E9%A3%8E%E5%A4%A7%E5%B1%8F%E8%AE%B0%E5%BD%951/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://youxt-njnu.github.io" target="_blank">Pale Bule Dot</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/threejs/">threejs</a><a class="post-meta__tags" href="/tags/shader/">shader</a></div><div class="post_share"><div class="social-share" data-image="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://s2.loli.net/2023/08/28/71kgQ3BTsGVqFwW.jpg" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2023/08/28/71kgQ3BTsGVqFwW.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://s2.loli.net/2023/08/28/3EHiwCLGzZtmN7T.jpg" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2023/08/28/3EHiwCLGzZtmN7T.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/28/shader-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%954/" title="shader-学习记录Ⅳ"><img class="cover" src="https://wallroom.io/img/5120x2880/bg-d896c9d.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">shader-学习记录Ⅳ</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/23/shader-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%953/" title="shader-学习记录Ⅲ"><img class="cover" src="https://wallroom.io/img/5120x2880/bg-d896c9d.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">shader-学习记录Ⅲ</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/09/17/three-%E8%B5%9B%E5%8D%9A%E9%A3%8E%E5%A4%A7%E5%B1%8F%E8%AE%B0%E5%BD%953/" title="three案例实操|赛博风大屏Ⅲ"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-17</div><div class="title">three案例实操|赛博风大屏Ⅲ</div></div></a></div><div><a href="/2024/09/21/three-%E8%B5%9B%E5%8D%9A%E5%A4%A7%E5%B1%8F%E5%A1%AB%E5%9D%911/" title="three案例实操|赛博风大屏坑①"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-21</div><div class="title">three案例实操|赛博风大屏坑①</div></div></a></div><div><a href="/2024/09/11/three-%E8%B5%9B%E5%8D%9A%E9%A3%8E%E5%A4%A7%E5%B1%8F%E8%AE%B0%E5%BD%952/" title="three案例实操|赛博风大屏Ⅱ"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-11</div><div class="title">three案例实操|赛博风大屏Ⅱ</div></div></a></div><div><a href="/2024/01/07/Notes_3d_portfolio_primary/" title="threejs实战笔记"><img class="cover" src="https://wallroom.io/img/1920x1080/bg-e67cc24.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-07</div><div class="title">threejs实战笔记</div></div></a></div><div><a href="/2024/03/23/three-demo-%E6%95%B0%E5%AD%97%E5%9C%B0%E7%90%83/" title="demo| 数字地球星空"><img class="cover" src="https://s2.loli.net/2023/08/29/NgxX5HO2tsJ6GRo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-23</div><div class="title">demo| 数字地球星空</div></div></a></div><div><a href="/2024/09/02/three-%E5%8A%A0%E8%87%AA%E5%B7%B1%E6%A8%A1%E5%9E%8B/" title="three+react|加自己模型"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-02</div><div class="title">three+react|加自己模型</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/tit.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Shealin You</div><div class="author-info__description">Be brave, and know yourself</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">80</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">60</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">28</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/youxt-njnu"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:10190208@njnu.edu.cn" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://www.zhihu.com/people/paleYYY" target="_blank" title="zhihu"><i class="fa-brands fa-zhihu" style="color: #24292e;"></i></a><a class="social-icon" href="https://dclef.icu/atom.xml" target="_blank" title=""><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">人生苦旅，踽踽独行之</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83"><span class="toc-number">2.</span> <span class="toc-text">基础环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="toc-number">3.</span> <span class="toc-text">代码框架</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%A7%E5%9C%B0%E7%90%83%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">大地球模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%83%E4%BD%93%E4%B8%8A%E7%9A%84%E7%82%B9"><span class="toc-number">4.1.</span> <span class="toc-text">球体上的点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%90%83%E6%9D%90%E8%B4%A8%E5%92%8C%E6%9E%84%E9%80%A0"><span class="toc-number">4.2.</span> <span class="toc-text">球材质和构造</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85-replace%E6%96%B9%E6%B3%95"><span class="toc-number">4.2.1.</span> <span class="toc-text">补充 | replace方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85-define%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">4.2.2.</span> <span class="toc-text">补充 | define的作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85-%E5%86%85%E9%83%A8%E4%BB%A3%E7%A0%81%E5%AE%9A%E4%B9%89%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">4.2.3.</span> <span class="toc-text">补充 | 内部代码定义的变量</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/12/AI%E5%8A%A9%E5%8A%9B%E5%86%99doc%E6%96%87%E6%A1%A3/" title="AI助力| python帮写mdx文档"><img src="https://wallroom.io/img/1920x1200/bg-0e129fe.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI助力| python帮写mdx文档"/></a><div class="content"><a class="title" href="/2025/04/12/AI%E5%8A%A9%E5%8A%9B%E5%86%99doc%E6%96%87%E6%A1%A3/" title="AI助力| python帮写mdx文档">AI助力| python帮写mdx文档</a><time datetime="2025-04-12T08:44:05.000Z" title="发表于 2025-04-12 16:44:05">2025-04-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/25/threejs%E6%BA%90%E7%A0%811/" title="threejs源码学习"><img src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="threejs源码学习"/></a><div class="content"><a class="title" href="/2024/10/25/threejs%E6%BA%90%E7%A0%811/" title="threejs源码学习">threejs源码学习</a><time datetime="2024-10-25T02:34:05.000Z" title="发表于 2024-10-25 10:34:05">2024-10-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/10/23/%E5%BF%AB%E6%8D%B7%E9%94%AE%E8%AE%B0%E5%BD%95/" title="快捷键记录"><img src="https://4k.wpcoder.cn/wp-content/uploads/2023/08/1_1692634360-1600x900.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="快捷键记录"/></a><div class="content"><a class="title" href="/2024/10/23/%E5%BF%AB%E6%8D%B7%E9%94%AE%E8%AE%B0%E5%BD%95/" title="快捷键记录">快捷键记录</a><time datetime="2024-10-23T02:30:23.000Z" title="发表于 2024-10-23 10:30:23">2024-10-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/21/three-%E8%B5%9B%E5%8D%9A%E5%A4%A7%E5%B1%8F%E5%A1%AB%E5%9D%911/" title="three案例实操|赛博风大屏坑①"><img src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="three案例实操|赛博风大屏坑①"/></a><div class="content"><a class="title" href="/2024/09/21/three-%E8%B5%9B%E5%8D%9A%E5%A4%A7%E5%B1%8F%E5%A1%AB%E5%9D%911/" title="three案例实操|赛博风大屏坑①">three案例实操|赛博风大屏坑①</a><time datetime="2024-09-21T06:02:05.000Z" title="发表于 2024-09-21 14:02:05">2024-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/17/three-%E8%B5%9B%E5%8D%9A%E9%A3%8E%E5%A4%A7%E5%B1%8F%E8%AE%B0%E5%BD%953/" title="three案例实操|赛博风大屏Ⅲ"><img src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="three案例实操|赛博风大屏Ⅲ"/></a><div class="content"><a class="title" href="/2024/09/17/three-%E8%B5%9B%E5%8D%9A%E9%A3%8E%E5%A4%A7%E5%B1%8F%E8%AE%B0%E5%BD%953/" title="three案例实操|赛博风大屏Ⅲ">three案例实操|赛博风大屏Ⅲ</a><time datetime="2024-09-17T10:02:05.000Z" title="发表于 2024-09-17 18:02:05">2024-09-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/index_img.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2025 By Shealin You</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Training the faculty of mindfulness is like breathing oxygen continuously to remain alive.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'StmwBdb4aXO6LMYWRxjVnufr-gzGzoHsz',
      appKey: 'V7WavrdJsNE6xxx5YGiygidl',
      avatar: 'monsterid',
      serverURLs: 'https://stmwbdb4.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="000EDNt20L3sUT" data-server="tencent" data-type="song" data-fixed="true" data-autoplay="true" data-lrcType="-1"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>