<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>three+react|个人主页实战Ⅲ | Pale Bule Dot</title><meta name="author" content="Shealin You"><meta name="copyright" content="Shealin You"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="说明模仿项目地址，参考的视频教程出处，react入门 react three fiber 本文是对Island.jsx及其相关文件的学习解读，内容中含ChatGPT辅助生成❗自辨❗❗❗ 相关代码Island.jsx&#x2F;*Auto-generated by: https:&#x2F;&#x2F;github.com&#x2F;pmndrs&#x2F;gltfjsxAuthor: nimzu (https:&#x2F;&#x2F;sketchfab.com&#x2F;ni">
<meta property="og:type" content="article">
<meta property="og:title" content="three+react|个人主页实战Ⅲ">
<meta property="og:url" content="https://youxt-njnu.github.io/2024/02/25/threejs%E5%AE%9E%E6%88%983/index.html">
<meta property="og:site_name" content="Pale Bule Dot">
<meta property="og:description" content="说明模仿项目地址，参考的视频教程出处，react入门 react three fiber 本文是对Island.jsx及其相关文件的学习解读，内容中含ChatGPT辅助生成❗自辨❗❗❗ 相关代码Island.jsx&#x2F;*Auto-generated by: https:&#x2F;&#x2F;github.com&#x2F;pmndrs&#x2F;gltfjsxAuthor: nimzu (https:&#x2F;&#x2F;sketchfab.com&#x2F;ni">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg">
<meta property="article:published_time" content="2024-02-25T03:50:05.000Z">
<meta property="article:modified_time" content="2024-06-13T02:15:02.801Z">
<meta property="article:author" content="Shealin You">
<meta property="article:tag" content="threejs">
<meta property="article:tag" content="react">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://youxt-njnu.github.io/2024/02/25/threejs%E5%AE%9E%E6%88%983/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'three+react|个人主页实战Ⅲ',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-13 10:15:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Pale Bule Dot" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/tit.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">56</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="https://youxt-njnu.github.io/about_portfolio"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url('https://wallroom.io/img/3840x2160/bg-81f2d39.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Pale Bule Dot"><img class="site-icon" src="https://cdn.jsdelivr.net/gh/youxt-njnu/blog-img/favicon.png"/><span class="site-name">Pale Bule Dot</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 类别</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="https://youxt-njnu.github.io/about_portfolio"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">three+react|个人主页实战Ⅲ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-02-25T03:50:05.000Z" title="发表于 2024-02-25 11:50:05">2024-02-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-13T02:15:02.801Z" title="更新于 2024-06-13 10:15:02">2024-06-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/3DGIS/">3DGIS</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/3DGIS/WebGL/">WebGL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="three+react|个人主页实战Ⅲ"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p><a target="_blank" rel="noopener" href="https://github.com/youxt-njnu/3d_portfolio_primary">模仿项目地址</a>，<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=FkowOdMjvYo">参考的视频教程出处</a>，<a target="_blank" rel="noopener" href="https://juejin.cn/post/6960262593265025031">react入门</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.pmnd.rs/react-three-fiber/getting-started/your-first-scene#adding-lights">react three fiber</a></p>
<p>本文是对Island.jsx及其相关文件的学习解读，内容中含ChatGPT辅助生成❗自辨❗❗❗</p>
<h1 id="相关代码"><a href="#相关代码" class="headerlink" title="相关代码"></a>相关代码</h1><h2 id="Island-jsx"><a href="#Island-jsx" class="headerlink" title="Island.jsx"></a>Island.jsx</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Auto-generated by: https://github.com/pmndrs/gltfjsx</span></span><br><span class="line"><span class="comment">Author: nimzu (https://sketchfab.com/nimzuk)</span></span><br><span class="line"><span class="comment">License: CC-BY-4.0 (http://creativecommons.org/licenses/by/4.0/)</span></span><br><span class="line"><span class="comment">Source: https://sketchfab.com/3d-models/foxs-islands-163b68e09fcc47618450150be7785907</span></span><br><span class="line"><span class="comment">Title: Fox&#x27;s islands</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; a &#125; <span class="keyword">from</span> <span class="string">&#x27;@react-spring/three&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useGLTF &#125; <span class="keyword">from</span> <span class="string">&quot;@react-three/drei&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useFrame, useThree &#125; <span class="keyword">from</span> <span class="string">&quot;@react-three/fiber&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> isLandScene <span class="keyword">from</span> <span class="string">&#x27;../assets/3d/island.glb&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Island</span> = (<span class="params">&#123; isRotating, setIsRotating, setCurrentStage, ...props &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> islandRef = <span class="title function_">useRef</span>(); <span class="comment">// 对应到了Three的Group, 用于控制整个模型(islandRef.current, 即island的gameobject)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; gl, viewport &#125; = <span class="title function_">useThree</span>();<span class="comment">// 获取Three的渲染器，视口</span></span><br><span class="line">  <span class="keyword">const</span> &#123; nodes, materials &#125; = <span class="title function_">useGLTF</span>(isLandScene); <span class="comment">// 获取模型的nodes和materials</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> lastX = <span class="title function_">useRef</span>(<span class="number">0</span>); <span class="comment">// 用于记录上一次的鼠标位置。这个值在组件的重渲染之间保持不变，而且这些值的变化不会触发组件的重新渲染</span></span><br><span class="line">  <span class="keyword">const</span> rotationSpeed = <span class="title function_">useRef</span>(<span class="number">0</span>);  <span class="comment">// 这个值在组件的重渲染之间保持不变，而且这些值的变化不会触发组件的重新渲染</span></span><br><span class="line">  <span class="keyword">const</span> dampingFactor = <span class="number">0.95</span>; <span class="comment">// 阻尼系数</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handlePointerDown</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="title function_">setIsRotating</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> clientX = e.<span class="property">touches</span> ? e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">clientX</span> : e.<span class="property">clientX</span>; <span class="comment">//只需要考虑X方向的</span></span><br><span class="line">    lastX.<span class="property">current</span> = clientX;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handlePointerUp</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="title function_">setIsRotating</span>(<span class="literal">false</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handlePointerMove</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isRotating) &#123;</span><br><span class="line">      <span class="keyword">const</span> clientX = e.<span class="property">touches</span> ? e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">clientX</span> : e.<span class="property">clientX</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> delta = (clientX - lastX.<span class="property">current</span>) / viewport.<span class="property">width</span>;</span><br><span class="line">      islandRef.<span class="property">current</span>.<span class="property">rotation</span>.<span class="property">y</span> += delta * <span class="number">0.01</span> * <span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">      lastX.<span class="property">current</span> = clientX;</span><br><span class="line">      rotationSpeed.<span class="property">current</span> = delta * <span class="number">0.01</span> * <span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleKeyDown</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;ArrowLeft&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isRotating) <span class="title function_">setIsRotating</span>(<span class="literal">true</span>);</span><br><span class="line">      islandRef.<span class="property">current</span>.<span class="property">rotation</span>.<span class="property">y</span> += <span class="number">0.01</span> * <span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">      rotationSpeed.<span class="property">current</span> = <span class="number">0.0125</span>;<span class="comment">// 让旋转的效果更舒适些</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;ArrowRight&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isRotating) <span class="title function_">setIsRotating</span>(<span class="literal">true</span>);</span><br><span class="line">      islandRef.<span class="property">current</span>.<span class="property">rotation</span>.<span class="property">y</span> -= <span class="number">0.01</span> * <span class="title class_">Math</span>.<span class="property">PI</span>;</span><br><span class="line">      rotationSpeed.<span class="property">current</span> = -<span class="number">0.0125</span>;<span class="comment">// 让旋转的效果更舒适些</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleKeyUp</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;ArrowLeft&#x27;</span> || e.<span class="property">key</span> === <span class="string">&#x27;ArrowRight&#x27;</span>) &#123;</span><br><span class="line">      <span class="title function_">setIsRotating</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useFrame</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isRotating) &#123;</span><br><span class="line">      rotationSpeed.<span class="property">current</span> *= dampingFactor; <span class="comment">//每帧都会减小旋转速度</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(rotationSpeed.<span class="property">current</span>) &lt; <span class="number">0.001</span>) &#123; <span class="comment">//设定阈值后，停止旋转</span></span><br><span class="line">        rotationSpeed.<span class="property">current</span> = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      islandRef.<span class="property">current</span>.<span class="property">rotation</span>.<span class="property">y</span> += rotationSpeed.<span class="property">current</span>;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> rotation = islandRef.<span class="property">current</span>.<span class="property">rotation</span>.<span class="property">y</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Mormalize the rotation value to ensure it stays within the range[0, 2 * Math.PI].</span></span><br><span class="line">      <span class="comment">// The goal is to ensure that the rotation value remains within a specific range to prevent potential issues with very large or negative rotation values.</span></span><br><span class="line">      <span class="comment">//   Here&#x27;s a step-by-step explanation of what this code does:</span></span><br><span class="line">      <span class="comment">// 1. rotation % (2 * Math.PI) calculates the remainder of the rotation value when divided by 2 * Math.PI.This essentially wraps the rotation value around once it reaches a full circle(360 degrees) so that it stays within the range of 0 to 2 * Math.PI.</span></span><br><span class="line">      <span class="comment">// 2.(rotation % (2 * Math.PI)) + 2 * Math.PI adds 2 * Math.PI to the result from step 1. This is done to ensure that the value remains positive and within the range of 0 to 2 * Math.PI even if it was negative after the modulo operation in step 1.</span></span><br><span class="line">      <span class="comment">// 3. Finally, ((rotation%(2*Math.PI))+2*Math.PI)%(2*Math.PI) applies another modulo operation to the value obtained in step 2. This step guarantees that the value always stays with the range of 0 to 2*Math.PI, which is equivalent to a full circle in radians.</span></span><br><span class="line">      <span class="keyword">const</span> normalizeRotation = ((rotation % (<span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span>)) + <span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span>) % (<span class="number">2</span> * <span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//set the current stage based on the island&#x27;s orientation</span></span><br><span class="line">      <span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> normalizeRotation &gt;= <span class="number">5.45</span> &amp;&amp; normalizeRotation &lt;= <span class="number">5.85</span>: </span><br><span class="line">          <span class="title function_">setCurrentStage</span>(<span class="number">4</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> normalizeRotation &gt;= <span class="number">0.85</span> &amp;&amp; normalizeRotation &lt;= <span class="number">1.3</span>:</span><br><span class="line">          <span class="title function_">setCurrentStage</span>(<span class="number">3</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> normalizeRotation &gt;= <span class="number">2.4</span> &amp;&amp; normalizeRotation &lt;= <span class="number">2.6</span>:</span><br><span class="line">          <span class="title function_">setCurrentStage</span>(<span class="number">2</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> normalizeRotation &gt;= <span class="number">4.25</span> &amp;&amp; normalizeRotation &lt;= <span class="number">4.75</span>:</span><br><span class="line">          <span class="title function_">setCurrentStage</span>(<span class="number">1</span>);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">          <span class="title function_">setCurrentStage</span>(<span class="literal">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> canvas = gl.<span class="property">domElement</span>;</span><br><span class="line">    canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;pointerdown&#x27;</span>, handlePointerDown);</span><br><span class="line">    canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;pointerup&#x27;</span>, handlePointerUp);</span><br><span class="line">    canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;pointermove&#x27;</span>, handlePointerMove);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, handleKeyDown);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keyup&#x27;</span>, handleKeyUp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      canvas.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;pointerdown&#x27;</span>, handlePointerDown);</span><br><span class="line">      canvas.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;pointerup&#x27;</span>, handlePointerUp);</span><br><span class="line">      canvas.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;pointermove&#x27;</span>, handlePointerMove);</span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, handleKeyDown);</span><br><span class="line">      <span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;keyup&#x27;</span>, handleKeyUp);</span><br><span class="line">    &#125;  <span class="comment">// 返回的这个函数将在组件卸载或依赖项改变之前执行</span></span><br><span class="line">  &#125;, [gl, handlePointerDown, handlePointerUp, handlePointerMove]); <span class="comment">//只有当这三个变量改变时，里面函数才会执行</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">a.group</span> <span class="attr">ref</span>=<span class="string">&#123;islandRef&#125;</span> &#123;<span class="attr">...props</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">mesh</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">geometry</span>=<span class="string">&#123;nodes.polySurface944_tree_body_0.geometry&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">material</span>=<span class="string">&#123;materials.PaletteMaterial001&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">mesh</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">geometry</span>=<span class="string">&#123;nodes.polySurface945_tree1_0.geometry&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">material</span>=<span class="string">&#123;materials.PaletteMaterial001&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">mesh</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">geometry</span>=<span class="string">&#123;nodes.polySurface946_tree2_0.geometry&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">material</span>=<span class="string">&#123;materials.PaletteMaterial001&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">mesh</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">geometry</span>=<span class="string">&#123;nodes.polySurface947_tree1_0.geometry&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">material</span>=<span class="string">&#123;materials.PaletteMaterial001&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">mesh</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">geometry</span>=<span class="string">&#123;nodes.polySurface948_tree_body_0.geometry&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">material</span>=<span class="string">&#123;materials.PaletteMaterial001&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">mesh</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">geometry</span>=<span class="string">&#123;nodes.polySurface949_tree_body_0.geometry&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">material</span>=<span class="string">&#123;materials.PaletteMaterial001&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">mesh</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">geometry</span>=<span class="string">&#123;nodes.pCube11_rocks1_0.geometry&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">material</span>=<span class="string">&#123;materials.PaletteMaterial001&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">a.group</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Island</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Home-jsx"><a href="#Home-jsx" class="headerlink" title="Home.jsx"></a>Home.jsx</h2><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Canvas</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@react-three/fiber&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Suspense</span>, useEffect, useRef, useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">HomeInfo</span> <span class="keyword">from</span> <span class="string">&#x27;../components/HomeInfo&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Loader</span> <span class="keyword">from</span> <span class="string">&#x27;../components/Loader&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Island</span> <span class="keyword">from</span> <span class="string">&#x27;../models/Island&#x27;</span></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Home</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="keyword">const</span> [isRotating, setIsRotating] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> [currentStage, setCurrentStage] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">  ......</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">adjustIslandForScreenSize</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> screenScale = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> screenPosition = [<span class="number">0</span>, -<span class="number">6.5</span>, -<span class="number">43</span>];</span><br><span class="line">    <span class="keyword">let</span> rotation = [<span class="number">0.1</span>, <span class="number">4.7</span>, <span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">innerWidth</span> &lt; <span class="number">768</span>) &#123;</span><br><span class="line">      screenScale = [<span class="number">0.9</span>, <span class="number">0.9</span>, <span class="number">0.9</span>];</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      screenScale = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [screenScale, screenPosition, rotation];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [islandScale, islandPosition, islandRotation] = <span class="title function_">adjustIslandForScreenSize</span>();</span><br><span class="line">  ......</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">&#x27;w-full h-screen relative&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;absolute top-28 left-0 right-0 z-10 flex items-center justify-center&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;currentStage &amp;&amp; <span class="tag">&lt;<span class="name">HomeInfo</span> <span class="attr">currentStage</span>=<span class="string">&#123;currentStage&#125;</span> /&gt;</span>&#125; <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Canvas</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">className</span>=<span class="string">&#123;</span>`<span class="attr">w-full</span> <span class="attr">h-screen</span> <span class="attr">bg-transparent</span> $&#123;<span class="attr">isRotating</span> ? &#x27;<span class="attr">cursor-grabbing</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">cursor-grab</span>&#x27;&#125; `&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">camera</span>=<span class="string">&#123;&#123;</span> <span class="attr">near:</span> <span class="attr">0.1</span>, <span class="attr">far:</span> <span class="attr">1000</span> &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;/* Suspense 用于解决加载组件时的白屏，可以显示其他的内容，而其他内容不允许使用 lazy加载 */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loader</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">directionalLight</span> <span class="attr">position</span>=<span class="string">&#123;[1,</span> <span class="attr">1</span>, <span class="attr">1</span>]&#125; <span class="attr">intensity</span>=<span class="string">&#123;2&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          ......</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Island</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">position</span>=<span class="string">&#123;islandPosition&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">scale</span>=<span class="string">&#123;islandScale&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">rotation</span>=<span class="string">&#123;islandRotation&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">isRotating</span>=<span class="string">&#123;isRotating&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">setIsRotating</span>=<span class="string">&#123;setIsRotating&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">setCurrentStage</span>=<span class="string">&#123;setCurrentStage&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Canvas</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ......</span></span><br><span class="line"><span class="language-xml">    &lt;/section &gt;</span></span><br><span class="line"><span class="language-xml">  )</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">export default Home</span></span><br></pre></td></tr></table></figure>

<h1 id="涉及知识点"><a href="#涉及知识点" class="headerlink" title="涉及知识点"></a>涉及知识点</h1><h2 id="Three"><a href="#Three" class="headerlink" title="Three"></a>Three</h2><h3 id="a-in-‘-react-spring-x2F-three’"><a href="#a-in-‘-react-spring-x2F-three’" class="headerlink" title="a in ‘@react-spring&#x2F;three’"></a>a in ‘@react-spring&#x2F;three’</h3><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; a &#125; <span class="keyword">from</span> <span class="string">&#x27;@react-spring/three&#x27;</span>;</span><br><span class="line">......</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">a.group</span> <span class="attr">ref</span>=<span class="string">&#123;islandRef&#125;</span> &#123;<span class="attr">...props</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">mesh</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">geometry</span>=<span class="string">&#123;nodes.polySurface944_tree_body_0.geometry&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">material</span>=<span class="string">&#123;materials.PaletteMaterial001&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      /&gt;</span></span></span><br><span class="line"><span class="language-xml">      ......</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">a.group</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>在这个上下文中，<code>a</code>很可能是 <code>@react-spring/three</code>库的命名导入，用于访问 <code>react-spring</code>提供的用于Three.js对象的动画化包装器。<code>react-spring</code>是一个流行的React库，用于创建流畅和自然的动画效果。<code>@react-spring/three</code>是专门为Three.js集成提供的，使得在Three.js环境中使用 <code>react-spring</code>变得简单。</p>
<p>在这段代码中：</p>
<ul>
<li>**<code>a.group</code>**：这是 <code>@react-spring/three</code>提供的一个组件，它是对Three.js中 <code>THREE.Group</code>的动画化包装。在Three.js中，<code>Group</code>对象用于创建对象的集合，这样你可以作为一个单元来平移、旋转和缩放它们。在 <code>react-spring/three</code>中，<code>a.group</code>允许你对这个组应用动画，比如平移、旋转或透明度变化等。</li>
<li>**<code>&lt;mesh /&gt;</code>**：这是一个Three.js中用于表示具有几何形状和材质的物体的组件。在这个示例中，<code>mesh</code>组件使用了 <code>geometry</code>（几何体）和 <code>material</code>（材质）两个属性，分别指定了物体的形状和表面处理。这不是 <code>react-spring</code>特有的，而是Three.js中的基本概念，但在这里它被放置在 <code>a.group</code>内部，表明你可以对整个组和组内的单个物体进行动画处理。</li>
</ul>
<p><code>a</code>是一个特殊的前缀，用于访问 <code>react-spring/three</code>提供的动画化组件。使用 <code>react-spring/three</code>，你可以给Three.js的对象添加流畅的物理基础动画，比如弹簧动画。<code>react-spring</code>的动画不仅限于简单的过渡，它支持从初始状态到结束状态的自然动画，包括反弹、停止等自然运动的效果。</p>
<p><code>&lt;a.group&gt;</code>组件继承自Three.js的 <code>Group</code>类，将Three.js对象（如 <code>Group</code>、<code>Mesh</code>等）用 <code>a.</code>前缀包装，并通过 <code>@react-spring/three</code>获得了动画能力。在Three.js中，<code>Group</code>是一个用于包含和管理多个其他对象（例如，几何体、网格等）的容器。它本身是 <code>Object3D</code>的一个子类，这意味着它继承了 <code>Object3D</code>的所有属性，包括 <code>position</code>、<code>scale</code>和 <code>rotation</code>。</p>
<h3 id="useThree-“-react-three-x2F-fiber”"><a href="#useThree-“-react-three-x2F-fiber”" class="headerlink" title="useThree “@react-three&#x2F;fiber”"></a>useThree “@react-three&#x2F;fiber”</h3><p>在 <code>@react-three/fiber</code> 中，<code>useThree</code> 是一个 React Hook，它提供了访问 Three.js 渲染上下文中的各种属性和方法的能力。</p>
<p>当你在组件中调用 <code>useThree()</code> 时，它返回一个对象，这个对象包含了当前 Three.js 渲染上下文的多个属性和实例。这样，你就可以在你的组件中直接访问和使用这些属性和实例，而无需手动管理它们。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; gl, viewport &#125; = <span class="title function_">useThree</span>();</span><br></pre></td></tr></table></figure>

<p>这行代码的作用是从 <code>useThree()</code> 返回的上下文对象中解构出 <code>gl</code> 和 <code>viewport</code> 两个属性：</p>
<ul>
<li>**<code>gl</code>**：这是对 WebGLRenderer 的引用，即 Three.js 使用的 WebGL 渲染器实例。通过这个实例，你可以控制渲染过程，比如调整清除颜色、执行后处理等。</li>
<li>**<code>viewport</code>**：这包含了关于当前视口的信息，如视口的宽度和高度，以及一些用于将屏幕坐标转换为Three.js世界坐标的工具函数。这对于响应式设计和动态布局非常有用。</li>
</ul>
<p>在Three.js中，<code>WebGLRenderer</code>是用来渲染场景（<code>THREE.Scene</code>）到一个Web页面上的canvas元素中。它使用WebGL API来绘制定义好的3D对象。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>(&#123; <span class="attr">antialias</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">renderer.<span class="title function_">setSize</span>(<span class="variable language_">window</span>.<span class="property">innerWidth</span>, <span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br></pre></td></tr></table></figure>

<p><code>WebGLRenderer</code>生成的canvas元素需要被添加到HTML文档中，这样渲染的结果才能显示给用户。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(renderer.<span class="property">domElement</span>);</span><br><span class="line">......</span><br><span class="line">renderer.<span class="title function_">render</span>(scene, camera);</span><br></pre></td></tr></table></figure>

<h3 id="useFrame"><a href="#useFrame" class="headerlink" title="useFrame()"></a>useFrame()</h3><p><code>useFrame</code> 是一个来自 <code>@react-three/fiber</code> 的 React Hook，它允许你在 React 的函数组件中插入和使用渲染循环。在 3D 应用和游戏开发中，渲染循环（也称为动画循环）是核心概念之一，负责在每一帧更新场景、相机、物体状态等，以及执行渲染操作。</p>
<p><code>useFrame</code> 接受一个回调函数作为参数，这个回调函数会在浏览器的动画帧循环中被不断调用。通常，这个回调函数接受两个参数：一个是渲染器的 <code>state</code>，另一个是渲染的 <code>delta</code> 时间（即从上一帧到当前帧的时间差，单位为秒）。</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="title function_">useFrame</span>(<span class="function">(<span class="params">state, delta</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 在这里编写每帧要执行的操作</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>假设你想在一个三维场景中旋转一个立方体，你可以使用 <code>useFrame</code> 来更新立方体的旋转状态：</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useFrame &#125; <span class="keyword">from</span> <span class="string">&#x27;@react-three/fiber&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Mesh</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">RotatingBox</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> ref = useRef&lt;<span class="title class_">Mesh</span>&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useFrame</span>(<span class="function">(<span class="params">state, delta</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ref.<span class="property">current</span>) &#123;</span><br><span class="line">      ref.<span class="property">current</span>.<span class="property">rotation</span>.<span class="property">x</span> += delta;</span><br><span class="line">      ref.<span class="property">current</span>.<span class="property">rotation</span>.<span class="property">y</span> += delta;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">mesh</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">boxGeometry</span> <span class="attr">args</span>=<span class="string">&#123;[1,</span> <span class="attr">1</span>, <span class="attr">1</span>]&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">meshStandardMaterial</span> <span class="attr">color</span>=<span class="string">&quot;orange&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">mesh</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，每一帧都会增加立方体的 <code>x</code> 和 <code>y</code> 轴旋转，<code>delta</code> 参数确保了旋转速度与帧率无关，提供了平滑一致的动画效果。</p>
<p>注意事项</p>
<ul>
<li>使用 <code>useFrame</code> 时要考虑性能。因为回调函数会在每一帧被调用，避免在其中执行复杂的计算或状态更新，这可能会导致性能问题。</li>
<li><code>useFrame</code> 是 <code>@react-three/fiber</code> 特有的，不是 React 官方 API 的一部分。它专门用于在 <code>@react-three/fiber</code> 提供的 <code>&lt;Canvas&gt;</code> 组件中使用，这个组件用于渲染 Three.js 的 3D 场景。</li>
</ul>
<h3 id="交互事件pointerdown"><a href="#交互事件pointerdown" class="headerlink" title="交互事件pointerdown"></a>交互事件pointerdown</h3><p>在Three.js中，虽然库本身主要聚焦于3D场景的渲染，但它通常用于Web环境，因此经常与HTML元素（如 <code>canvas</code>）以及Web事件模型进行交互。<code>pointerdown</code>、<code>pointerup</code>和 <code>pointermove</code>是指针事件，是Web标准的一部分，用于处理各种指针设备（如鼠标、触摸屏和笔设备）的输入。这些事件可以被用来增强Three.js场景的交互性。下面是每个事件的基本说明：</p>
<p>pointerdown</p>
<ul>
<li><strong>操作</strong>：当用户按下任何指针设备（例如，鼠标按键、触摸屏的触摸）时触发。</li>
<li><strong>用途</strong>：在Three.js应用中，<code>pointerdown</code>可以用来检测用户开始与场景中的对象进行交互的时刻，比如开始拖动物体、选中一个物体等。</li>
</ul>
<p>pointerup</p>
<ul>
<li><strong>操作</strong>：当用户释放之前按下的指针设备时触发。</li>
<li><strong>用途</strong>：在Three.js应用中，<code>pointerup</code>事件可以用来检测用户结束交互的时刻，例如放开拖动的物体、确认选中的物体等。</li>
</ul>
<p>pointermove</p>
<ul>
<li><strong>操作</strong>：当指针设备在屏幕上移动时触发，不论是否按下。</li>
<li><strong>用途</strong>：<code>pointermove</code>在Three.js中非常有用，可以用来实现对象的拖拽效果、在场景中导航（如旋转视角、缩放场景）或实时追踪鼠标&#x2F;触摸的位置以创建动态效果。</li>
</ul>
<p>为了在Three.js的 <code>canvas</code>元素上监听这些事件，你可以直接在 <code>canvas</code>元素上添加事件监听器：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> canvas = renderer.<span class="property">domElement</span>; <span class="comment">// 假设你已经有一个Three.js渲染器</span></span><br><span class="line"></span><br><span class="line">canvas.<span class="title function_">addEventListener</span>(<span class="string">&#x27;pointerdown&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Pointer down&#x27;</span>, event);</span><br><span class="line">    <span class="comment">// 在这里添加当指针按下时的处理逻辑</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Pointer Type: <span class="subst">$&#123;event.pointerType&#125;</span>`</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Pointer Position: (<span class="subst">$&#123;event.clientX&#125;</span>, <span class="subst">$&#123;event.clientY&#125;</span>)`</span>);</span><br><span class="line">    <span class="comment">// 阻止默认行为和事件冒泡</span></span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    event.<span class="title function_">stopPropagation</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>event</code>对象的作用</p>
<ul>
<li><strong>事件类型识别</strong>：<code>event.type</code>属性可以告诉你事件的具体类型（如 <code>&quot;pointerdown&quot;</code>），有助于在使用同一个事件处理函数处理多种事件类型时进行区分。</li>
<li><strong>获取指针位置</strong>：<code>event.clientX</code>和 <code>event.clientY</code>属性提供了指针在视口中的坐标位置，而 <code>event.pageX</code>和 <code>event.pageY</code>则提供了指针在整个页面中的位置。这对于实现拖拽功能或在画布上绘图等功能非常有用。</li>
<li><strong>区分指针设备</strong>：<code>event.pointerType</code>属性可以告诉你触发事件的指针设备类型（如 <code>&quot;mouse&quot;</code>、<code>&quot;pen&quot;</code>或 <code>&quot;touch&quot;</code>），这有助于实现针对不同设备的特定交互响应。</li>
<li><strong>阻止默认行为</strong>：<code>event.preventDefault()</code>方法可以用来阻止事件的默认行为（如果有的话），例如阻止点击链接导航到新页面的默认行为。</li>
<li><strong>停止事件冒泡</strong>：<code>event.stopPropagation()</code>方法可以阻止事件进一步传播到其他事件监听器。</li>
</ul>
<p>注意事项</p>
<ul>
<li>使用指针事件可以让你的应用更好地适应不同的输入设备，而不仅仅是鼠标。</li>
<li>确保合理使用事件监听器，避免在高频事件（如 <code>pointermove</code>）中执行计算量大的操作，这可能会影响性能。</li>
<li>在处理这些事件时，考虑事件对象（<code>event</code>）提供的信息，如指针位置、按下的按钮等，这些信息对于实现精确的交互逻辑非常有用。</li>
</ul>
<h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2><h3 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h3><p><code>useState</code> 是React的一个Hook，它允许你在函数组件中添加状态。在React 16.8之前，函数组件被称为无状态组件，意味着你不能在其中使用状态（state）或生命周期方法。<code>useState</code>的引入改变了这一点，让函数组件也能够拥有和类组件一样的状态管理能力。</p>
<p><code>useState</code>的基本用法非常简单。它接受一个参数，这个参数是状态的初始值，然后返回一个数组，这个数组包含两个元素：当前的状态值和一个更新这个状态值的函数。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">function Example() &#123;</span><br><span class="line">  // 声明一个新的状态变量，我们将其称之为 &quot;count&quot;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;You clicked &#123;count&#125; times&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;</span><br><span class="line">        Click me</span><br><span class="line">      &lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在这个例子中，</strong><code>useState(0)</code>声明了一个新的状态变量 <code>count</code>，并将其初始值设为0。<code>setCount</code>是一个函数，用于更新 <code>count</code>的值。当你点击按钮时，调用 <code>setCount(count + 1)</code>来增加 <code>count</code>的值。</p>
<p><strong>你可以在一个组件中多次调用</strong> <code>useState</code>，以声明多个状态变量。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import React, &#123; useState &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">function ExampleWithManyStates() &#123;</span><br><span class="line">  // 声明多个状态变量</span><br><span class="line">  const [age, setAge] = useState(42);</span><br><span class="line">  const [fruit, setFruit] = useState(&#x27;banana&#x27;);</span><br><span class="line">  const [todos, setTodos] = useState([&#123; text: &#x27;学习 Hook&#x27; &#125;]);</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>函数式更新：如果新的状态依赖于前一个状态，你可以给更新函数传入一个函数，这个函数将接收前一个状态作为参数，并返回一个新状态。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">function Counter() &#123;</span><br><span class="line">  const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;p&gt;The count is &#123;count&#125;&lt;/p&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(prevCount =&gt; prevCount + 1)&#125;&gt;+1&lt;/button&gt;</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; setCount(prevCount =&gt; prevCount - 1)&#125;&gt;-1&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="惰性初始状态"><a href="#惰性初始状态" class="headerlink" title="惰性初始状态"></a>惰性初始状态</h4><p><code>useState</code>允许你传入一个函数来延迟计算初始状态，这对于初始状态计算开销较大的情况非常有用。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const [state, setState] = useState(() =&gt; &#123;</span><br><span class="line">  const initialState = someExpensiveComputation(props);</span><br><span class="line">  return initialState;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>在这个例子中，</strong><code>someExpensiveComputation</code>只会在组件初次渲染时被调用，从而避免了在每次渲染时都重新计算初始状态的开销。</p>
<p><strong>通过</strong> <code>useState</code>，React为函数组件提供了状态管理的能力，使得开发者能够在不使用类组件的情况下，以一种简洁且易于理解的方式构建动态且响应式的用户界面。</p>
<h3 id="useRef"><a href="#useRef" class="headerlink" title="useRef"></a>useRef</h3><p><code>useRef</code> 是React的一个Hook，它用于在函数组件中存储一个可变的引用对象，这个对象在组件的整个生命周期内保持不变。<code>useRef</code>最常见的用途有两个：一是访问DOM节点，二是存储任何可变值。</p>
<h4 id="访问DOM节点"><a href="#访问DOM节点" class="headerlink" title="访问DOM节点"></a>访问DOM节点</h4><p><strong>当你需要直接操作DOM元素时，比如设置焦点、测量元素大小或位置等，</strong><code>useRef</code>可以用来获取DOM节点的引用。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import React, &#123; useRef, useEffect &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">function TextInputWithFocusButton() &#123;</span><br><span class="line">  // 初始化一个ref</span><br><span class="line">  const inputEl = useRef(null);</span><br><span class="line"></span><br><span class="line">  const onButtonClick = () =&gt; &#123;</span><br><span class="line">    // 当按钮被点击时，使用current属性访问DOM节点，并调用focus方法</span><br><span class="line">    inputEl.current.focus();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;&gt;</span><br><span class="line">      &#123;/* 使用ref属性将inputEl ref附加到输入元素上 */&#125;</span><br><span class="line">      &lt;input ref=&#123;inputEl&#125; type=&quot;text&quot; /&gt;</span><br><span class="line">      &lt;button onClick=&#123;onButtonClick&#125;&gt;Focus the input&lt;/button&gt;</span><br><span class="line">    &lt;/&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="存储任何可变值"><a href="#存储任何可变值" class="headerlink" title="存储任何可变值"></a>存储任何可变值</h4><p><code>useRef</code>也可以用来存储任何可变值，<strong>这个值在组件的重渲染之间保持不变。这对于存储任意值，如计时器ID、外部库的实例等特别有用，而且这些值的变化不会触发组件的重新渲染</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import React, &#123; useRef, useEffect &#125; from &#x27;react&#x27;;</span><br><span class="line"></span><br><span class="line">function TimerComponent() &#123;</span><br><span class="line">  const intervalId = useRef(null);</span><br><span class="line"></span><br><span class="line">  useEffect(() =&gt; &#123;</span><br><span class="line">    intervalId.current = setInterval(() =&gt; &#123;</span><br><span class="line">      console.log(&#x27;Timer tick&#x27;);</span><br><span class="line">    &#125;, 1000);</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      clearInterval(intervalId.current);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  return &lt;div&gt;Check the console for timer ticks.&lt;/div&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在这个例子中，</strong><code>intervalId</code>用于存储计时器ID，以便可以在组件卸载时清除计时器，防止内存泄露。</p>
<h4 id="useRef-vs-useState"><a href="#useRef-vs-useState" class="headerlink" title="useRef vs. useState"></a><code>useRef</code> vs. <code>useState</code></h4><p><strong>虽然</strong> <code>useState</code>也可以用于存储数据，但与 <code>useRef</code>相比，当状态更新时，<code>useState</code>会触发组件的重新渲染，而 <code>useRef</code>中的变化不会。因此，如果你需要在组件的多次渲染之间保持不变的数据，且这些数据的变化不应该触发组件的重新渲染，<code>useRef</code>是更合适的选择。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><code>useRef</code>在React函数组件中提供了一种简单的方式来访问DOM节点和存储可变数据。通过 <code>useRef</code>，你可以在组件的整个生命周期内保持对某个值的引用，而不会引起额外的渲染。这使得 <code>useRef</code>成为在需要直接操作DOM或需要跨渲染周期保持数据不变时的理想选择。</p>
<h3 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h3><p><code>useEffect</code> 是 React 的一个 Hook，它允许你在函数组件中执行副作用操作。副作用可以包括数据获取、订阅或手动修改 DOM 等操作，这些操作通常在组件渲染到屏幕之后执行。<code>useEffect</code> 的用法提供了一个优雅的方式来处理这些操作。<code>useEffect</code> 提供了一种在函数组件中处理生命周期事件的灵活方式，使得开发者能够更容易地管理副作用和资源。</p>
<p><code>useEffect</code> 接收两个参数：一个是副作用函数，另一个是依赖数组。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  // 在这里执行副作用操作</span><br><span class="line">&#125;, [/* 依赖项列表 */]);</span><br></pre></td></tr></table></figure>

<h4 id="没有依赖的-useEffect"><a href="#没有依赖的-useEffect" class="headerlink" title="没有依赖的 useEffect"></a>没有依赖的 useEffect</h4><p>如果 <code>b</code> 的依赖项列表为空（<code>[]</code>），副作用函数只会在组件挂载（mount）后执行一次。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  // 只会在组件挂载后执行一次</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<h4 id="带有依赖的-useEffect"><a href="#带有依赖的-useEffect" class="headerlink" title="带有依赖的 useEffect"></a>带有依赖的 useEffect</h4><p><strong>当你在依赖项列表中指定变量时，只有当这些变量改变时，副作用函数才会执行。这提供了一种方式来优化性能，避免不必要的副作用操作。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const [count, setCount] = useState(0);</span><br><span class="line"></span><br><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  // 当 `count` 变化时，这个副作用就会执行</span><br><span class="line">  document.title = `You clicked $&#123;count&#125; times`;</span><br><span class="line">&#125;, [count]); // 依赖项列表中包含 `count`</span><br></pre></td></tr></table></figure>

<h4 id="清理副作用"><a href="#清理副作用" class="headerlink" title="清理副作用"></a>清理副作用</h4><p><strong>有时候，你可能需要在组件卸载（unmount）或下一次副作用执行之前执行一些清理操作，比如取消订阅或清除定时器等。为此，你的副作用函数可以返回一个清理函数。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  const id = setInterval(() =&gt; &#123;</span><br><span class="line">    // 执行一些重复的操作</span><br><span class="line">  &#125;, 1000);</span><br><span class="line"></span><br><span class="line">  // 返回的这个函数将在组件卸载或依赖项改变之前执行</span><br><span class="line">  return () =&gt; clearInterval(id);</span><br><span class="line">&#125;, [/* 依赖项 */]);</span><br></pre></td></tr></table></figure>

<h4 id="没有依赖项的-useEffect"><a href="#没有依赖项的-useEffect" class="headerlink" title="没有依赖项的 useEffect"></a>没有依赖项的 useEffect</h4><p>**如果 **<code>useEffect</code> 被调用时没有提供依赖项列表，副作用函数将在组件每次渲染后执行。这通常不推荐，因为它可能会导致性能问题。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">useEffect(() =&gt; &#123;</span><br><span class="line">  // 每次组件渲染后都会执行</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="…props"><a href="#…props" class="headerlink" title="…props"></a>…props</h3><p><strong>在JSX中，</strong><code>...props</code>是一个使用了JavaScript的展开运算符（Spread Operator）的表达式，它用于将一个对象的所有可枚举属性，复制到当前对象中。在React组件中，这种语法经常用来传递 <code>props</code>（属性）。</p>
<p><strong>当你在JSX标签中使用</strong> <code>...props</code>时，你实际上是将一个包含多个属性的对象“展开”，并将这些属性作为单独的props传递给组件。这样做的好处是可以保持组件接口的灵活性，同时减少了代码的冗余。</p>
<p><strong>假设你有一个组件</strong> <code>&lt;MyComponent /&gt;</code>，你想传递给它多个props，如 <code>title</code>和 <code>onClick</code>等，而这些props是通过一个对象 <code>props</code>管理的，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">const props = &#123;</span><br><span class="line">  title: &#x27;Hello World&#x27;,</span><br><span class="line">  onClick: () =&gt; console.log(&#x27;Clicked&#x27;),</span><br><span class="line">  // 更多props...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>在不使用展开运算符的情况下，你需要逐一传递每个属性：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;MyComponent title=&#123;props.title&#125; onClick=&#123;props.onClick&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p><strong>使用展开运算符，上面的代码可以简化为：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;MyComponent &#123;...props&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p><strong>这行代码的作用是将</strong> <code>props</code>对象中的每个属性都作为单独的prop传递给 <code>MyComponent</code>组件。这不仅使代码更简洁，还使得 <code>MyComponent</code>组件能够接收任何通过 <code>props</code>对象传递的额外属性，而无需每次都显式声明它们。</p>
<p><strong>虽然使用展开运算符可以提高代码的灵活性和可读性，但在某些情况下也需要谨慎使用，因为：</strong></p>
<ul>
<li><strong>性能影响</strong>：如果对象很大，或这种操作在一个大型应用中频繁执行，它可能会对性能产生影响。</li>
<li><strong>属性覆盖</strong>：如果存在多个相同的属性名，后面的属性会覆盖前面的属性。在使用展开运算符时，需要注意属性的顺序和重复性。</li>
<li><strong>类型检查</strong>：在TypeScript等静态类型检查的环境中，使用展开运算符传递props时，可能需要确保传递的对象属性与组件的props类型兼容。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">调用为：</span><br><span class="line">&lt;Island</span><br><span class="line">position=&#123;islandPosition&#125;</span><br><span class="line">scale=&#123;islandScale&#125;</span><br><span class="line">rotation=&#123;islandRotation&#125;</span><br><span class="line">isRotating=&#123;isRotating&#125;</span><br><span class="line">setIsRotating=&#123;setIsRotating&#125;</span><br><span class="line">setCurrentStage=&#123;setCurrentStage&#125;</span><br><span class="line">/&gt;</span><br><span class="line"></span><br><span class="line">内容为：</span><br><span class="line">const Island = (&#123; isRotating, setIsRotating, setCurrentStage, ...props &#125;) =&gt; &#123; </span><br><span class="line">    ......</span><br><span class="line">    return (</span><br><span class="line">        &lt;a.group ref=&#123;islandRef&#125; &#123;...props&#125;&gt;</span><br><span class="line">            &lt;mesh</span><br><span class="line">                geometry=&#123;nodes.polySurface944_tree_body_0.geometry&#125;</span><br><span class="line">                material=&#123;materials.PaletteMaterial001&#125; </span><br><span class="line">                /&gt;</span><br><span class="line">            ......</span><br><span class="line">    )&#125; </span><br></pre></td></tr></table></figure>

<p><strong>在这个示例中，</strong><code>&lt;Island /&gt;</code>组件接收了多个属性（<code>props</code>），包括 <code>isRotating</code>、<code>setIsRotating</code>、<code>setCurrentStage</code>以及其他可能的属性（如 <code>position</code>、<code>scale</code>、<code>rotation</code>等, 这些属性对于Three.js中的对象来说是常见的变换属性）。在 <code>Island</code>组件的函数签名中，<code>...props</code>使用了JavaScript的展开运算符来收集除 <code>isRotating</code>、<code>setIsRotating</code>、<code>setCurrentStage</code>之外的所有传递给组件的属性。</p>
<p><strong>在</strong> <code>Island</code>组件内部，<code>...props</code>的作用是将这些额外的属性传递给 <code>&lt;a.group&gt;</code>组件。这样做有几个好处：</p>
<ol>
<li><strong>灵活性</strong>：允许 <code>Island</code>组件接收任何额外的属性，并将它们直接传递给内部的 <code>&lt;a.group&gt;</code>组件，而无需组件显式地声明或处理这些属性。这使得 <code>Island</code>组件更加灵活，可以适应不同的使用场景。</li>
<li><strong>简洁性</strong>：避免了需要显式地为每个可能的属性编写传递逻辑，从而使组件代码更加简洁和易于维护。</li>
<li><strong>组件封装</strong>：保持了 <code>Island</code>组件对于其内部实现的封装性。调用者无需关心 <code>Island</code>如何处理或转发这些属性，只需要知道它可以接收并适当地使用这些属性。</li>
</ol>
<p><code>&lt;a.group&gt;</code>组件继承自Three.js的 <code>Group</code>类，将Three.js对象（如 <code>Group</code>、<code>Mesh</code>等）用 <code>a.</code>前缀包装，并通过 <code>@react-spring/three</code>获得了动画能力。在Three.js中，<code>Group</code>是一个用于包含和管理多个其他对象（例如，几何体、网格等）的容器。它本身是 <code>Object3D</code>的一个子类，这意味着它继承了 <code>Object3D</code>的所有属性，包括 <code>position</code>、<code>scale</code>和 <code>rotation</code>。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://youxt-njnu.github.io">Shealin You</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://youxt-njnu.github.io/2024/02/25/threejs%E5%AE%9E%E6%88%983/">https://youxt-njnu.github.io/2024/02/25/threejs%E5%AE%9E%E6%88%983/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://youxt-njnu.github.io" target="_blank">Pale Bule Dot</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/threejs/">threejs</a><a class="post-meta__tags" href="/tags/react/">react</a></div><div class="post_share"><div class="social-share" data-image="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://s2.loli.net/2023/08/28/71kgQ3BTsGVqFwW.jpg" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2023/08/28/71kgQ3BTsGVqFwW.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://s2.loli.net/2023/08/28/3EHiwCLGzZtmN7T.jpg" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2023/08/28/3EHiwCLGzZtmN7T.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/03/09/threejs%E5%AE%9E%E6%88%984/" title="three+react|个人主页实战Ⅳ"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">three+react|个人主页实战Ⅳ</div></div></a></div><div class="next-post pull-right"><a href="/2024/02/25/three%E5%AE%9E%E6%88%982/" title="three+react|个人主页实战Ⅱ"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">three+react|个人主页实战Ⅱ</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/01/07/Notes_3d_portfolio_primary/" title="threejs实战笔记"><img class="cover" src="https://wallroom.io/img/1920x1080/bg-e67cc24.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-07</div><div class="title">threejs实战笔记</div></div></a></div><div><a href="/2024/03/09/threejs%E5%AE%9E%E6%88%9821/" title="three+react|个人主页实战Ⅱ(补)"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-09</div><div class="title">three+react|个人主页实战Ⅱ(补)</div></div></a></div><div><a href="/2024/02/25/three%E5%AE%9E%E6%88%981/" title="three+react|个人主页实战Ⅰ"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-25</div><div class="title">three+react|个人主页实战Ⅰ</div></div></a></div><div><a href="/2024/03/09/threejs%E5%AE%9E%E6%88%984/" title="three+react|个人主页实战Ⅳ"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-09</div><div class="title">three+react|个人主页实战Ⅳ</div></div></a></div><div><a href="/2024/02/25/three%E5%AE%9E%E6%88%982/" title="three+react|个人主页实战Ⅱ"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-25</div><div class="title">three+react|个人主页实战Ⅱ</div></div></a></div><div><a href="/2023/12/08/threejs%E4%B8%8A/" title="threejs API学习 Ⅰ"><img class="cover" src="https://wallroom.io/img/3840x2160/bg-81f2d39.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-12-08</div><div class="title">threejs API学习 Ⅰ</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/tit.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Shealin You</div><div class="author-info__description">Be brave, and know yourself</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">68</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">56</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">26</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/youxt-njnu"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:10190208@njnu.edu.cn" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://www.zhihu.com/people/paleYYY" target="_blank" title="zhihu"><i class="fa-brands fa-zhihu" style="color: #24292e;"></i></a><a class="social-icon" href="https://dclef.icu/atom.xml" target="_blank" title=""><i class="fas fa-rss"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">人生苦旅，踽踽独行之</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">相关代码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Island-jsx"><span class="toc-number">2.1.</span> <span class="toc-text">Island.jsx</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Home-jsx"><span class="toc-number">2.2.</span> <span class="toc-text">Home.jsx</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B6%89%E5%8F%8A%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">3.</span> <span class="toc-text">涉及知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Three"><span class="toc-number">3.1.</span> <span class="toc-text">Three</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-in-%E2%80%98-react-spring-x2F-three%E2%80%99"><span class="toc-number">3.1.1.</span> <span class="toc-text">a in ‘@react-spring&#x2F;three’</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useThree-%E2%80%9C-react-three-x2F-fiber%E2%80%9D"><span class="toc-number">3.1.2.</span> <span class="toc-text">useThree “@react-three&#x2F;fiber”</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useFrame"><span class="toc-number">3.1.3.</span> <span class="toc-text">useFrame()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%A4%E4%BA%92%E4%BA%8B%E4%BB%B6pointerdown"><span class="toc-number">3.1.4.</span> <span class="toc-text">交互事件pointerdown</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#React"><span class="toc-number">3.2.</span> <span class="toc-text">React</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#useState"><span class="toc-number">3.2.1.</span> <span class="toc-text">useState</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%83%B0%E6%80%A7%E5%88%9D%E5%A7%8B%E7%8A%B6%E6%80%81"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">惰性初始状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useRef"><span class="toc-number">3.2.2.</span> <span class="toc-text">useRef</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AEDOM%E8%8A%82%E7%82%B9"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">访问DOM节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E4%BB%BB%E4%BD%95%E5%8F%AF%E5%8F%98%E5%80%BC"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">存储任何可变值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#useRef-vs-useState"><span class="toc-number">3.2.2.3.</span> <span class="toc-text">useRef vs. useState</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.2.2.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useEffect"><span class="toc-number">3.2.3.</span> <span class="toc-text">useEffect</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E4%BE%9D%E8%B5%96%E7%9A%84-useEffect"><span class="toc-number">3.2.3.1.</span> <span class="toc-text">没有依赖的 useEffect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A6%E6%9C%89%E4%BE%9D%E8%B5%96%E7%9A%84-useEffect"><span class="toc-number">3.2.3.2.</span> <span class="toc-text">带有依赖的 useEffect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B8%85%E7%90%86%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="toc-number">3.2.3.3.</span> <span class="toc-text">清理副作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E4%BE%9D%E8%B5%96%E9%A1%B9%E7%9A%84-useEffect"><span class="toc-number">3.2.3.4.</span> <span class="toc-text">没有依赖项的 useEffect</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%80%A6props"><span class="toc-number">3.2.4.</span> <span class="toc-text">…props</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/08/23/shader-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%953/" title="shader-学习记录Ⅲ"><img src="https://wallroom.io/img/5120x2880/bg-d896c9d.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="shader-学习记录Ⅲ"/></a><div class="content"><a class="title" href="/2024/08/23/shader-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%953/" title="shader-学习记录Ⅲ">shader-学习记录Ⅲ</a><time datetime="2024-08-23T06:33:26.000Z" title="发表于 2024-08-23 14:33:26">2024-08-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/19/shader-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%952/" title="shader-学习记录Ⅱ"><img src="https://wallroom.io/img/5120x2880/bg-d896c9d.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="shader-学习记录Ⅱ"/></a><div class="content"><a class="title" href="/2024/08/19/shader-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%952/" title="shader-学习记录Ⅱ">shader-学习记录Ⅱ</a><time datetime="2024-08-19T03:55:26.000Z" title="发表于 2024-08-19 11:55:26">2024-08-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/16/shader-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%951/" title="shader-学习记录Ⅰ"><img src="https://wallroom.io/img/5120x2880/bg-d896c9d.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="shader-学习记录Ⅰ"/></a><div class="content"><a class="title" href="/2024/08/16/shader-%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%951/" title="shader-学习记录Ⅰ">shader-学习记录Ⅰ</a><time datetime="2024-08-16T07:52:26.000Z" title="发表于 2024-08-16 15:52:26">2024-08-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/13/Cesium%E4%B8%8A/" title="Cesium API学习 Ⅰ"><img src="https://wallroom.io/img/1920x1080/bg-9666a3c.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Cesium API学习 Ⅰ"/></a><div class="content"><a class="title" href="/2024/06/13/Cesium%E4%B8%8A/" title="Cesium API学习 Ⅰ">Cesium API学习 Ⅰ</a><time datetime="2024-06-13T03:06:05.000Z" title="发表于 2024-06-13 11:06:05">2024-06-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/13/WebAPIs/" title="WebAPIs 知识点梳理"><img src="https://wallroom.io/img/2880x1620/bg-bd4a6c6.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="WebAPIs 知识点梳理"/></a><div class="content"><a class="title" href="/2024/06/13/WebAPIs/" title="WebAPIs 知识点梳理">WebAPIs 知识点梳理</a><time datetime="2024-06-13T01:33:26.000Z" title="发表于 2024-06-13 09:33:26">2024-06-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/index_img.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Shealin You</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Training the faculty of mindfulness is like breathing oxygen continuously to remain alive.</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'StmwBdb4aXO6LMYWRxjVnufr-gzGzoHsz',
      appKey: 'V7WavrdJsNE6xxx5YGiygidl',
      avatar: 'monsterid',
      serverURLs: 'https://stmwbdb4.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="000EDNt20L3sUT" data-server="tencent" data-type="song" data-fixed="true" data-autoplay="true" data-lrcType="-1"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>